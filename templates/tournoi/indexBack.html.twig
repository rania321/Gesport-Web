{% extends 'baseBack.html.twig' %}

{% block title %}Tournoi index{% endblock %}

{% block content %}
<div class="main-panel">
  <div class="content-wrapper">
    <div class="row">
      <div class="col-md-12">
        <div class="card">
          <div class="card-body">
            <div class="row mb-3">
              <div class="col-md-6">
                <h4 class="card-title" style="color: rgb(7, 76, 141);">Liste des Tournois</h4>
              </div>
              <div class="col-md-6 text-end">
                <a href="{{ path('app_tournoi_new') }}" class="btn btn-inverse-primary">Créer un nouveau tournoi</a>
              </div>
            </div>
            <div class="row mb-3">
              
              <div class="col-md-6">
                <label for="search-input" class="icon-search">
                  Rechercher un tournoi :</label>
                <input type="text" id="search" placeholder="par nom" class="form-control">
              </div>
              <div class="col-md-6 ">
                <label for="tri" class="form-label">Trier les tournois :</label>
                <select id="tri" onchange="sortTournoi()" class="nav-link dropdown-bordered dropdown-toggle dropdown-toggle-split">
                  <option value="">Choisir...</option>
                  <option value="{{ path('tournoi_display_sorted_by_date_asc') }}">Date croissante</option>
                  <option value="{{ path('tournoi_display_sorted_by_date_desc') }}">Date décroissante</option>
                  <option value="{{ path('tournoi_display_sorted_by_lieu_asc') }}">Lieu croissant</option>
                  <option value="{{ path('tournoi_display_sorted_by_lieu_desc') }}">Lieu décroissant</option>
                  <option value="{{ path('tournoi_display_sorted_by_statut_asc') }}">Statut croissant</option>
                  <option value="{{ path('tournoi_display_sorted_by_statut_desc') }}">Statut décroissant</option>
                </select>
              </div>
            </div>
           
            <div class="table-responsive">
              <table class="table table-striped">
                <thead>
                  <tr>
                    <th scope="col">Nom Tournoi</th>
                    <th scope="col">Date de début</th>
                    <th scope="col">Date de fin</th>
                    <th scope="col"> Lieu</th>
                    <th scope="col">Statut</th>
                    <th scope="col">Actions</th>
                  </tr>
                </thead>
                <tbody id="results">
                  {% for tournoi in tournois %}
                    <tr>
                      <td>{{ tournoi.nomt }}</td>
                      <td>{{ tournoi.datedebutt ? tournoi.datedebutt|date('d/m/Y') : '' }}</td>
                      <td>{{ tournoi.datefint ? tournoi.datefint|date('d/m/Y') : '' }}</td>
                      <td><a href="https://www.google.com/maps/search/?api=1&query={{ tournoi.descrit }}" target="_blank" style="text-decoration: none; color: black;">{{ tournoi.descrit }}</a>
                      </td>
                      <td>
                        <span class="badge 
                        {% if tournoi.statutt == 'Terminé' %}
                          badge-danger
                        {% elseif tournoi.statutt == 'À venir' %}
                          badge-primary
                        {% else %}
                          badge-success
                        {% endif %}
                        ">
                          {{ tournoi.statutt }}
                        </span>
                      </td>
                      <td>
                        <div class="d-flex">
                          <a href="{{ path('app_tournoi_show', {'idt': tournoi.idt}) }}" class="btn btn-sm btn-outline-info btn-inverse-info me-1">
                            <i class="mdi mdi-eye"></i> Show
                          </a>
                          <a href="{{ path('app_tournoi_edit', {'idt': tournoi.idt}) }}" class="btn btn-sm btn-outline-warning btn-inverse-warning me-1">
                            <i class="mdi mdi-pencil"></i> Edit
                          </a>
                          <form method="post" action="{{ path('app_tournoi_delete', {'idt': tournoi.idt}) }}" onsubmit="return confirm('Are you sure you want to delete this item?');">
                            <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ tournoi.idt) }}">
                            <button type="submit" class="btn btn-sm btn-danger btn-inverse-danger" style="font-size: 13px;">
                              <i class="mdi mdi-delete"></i> Delete
                            </button>
                          </form>
                        </div>
                      </td>
                    </tr>
                  {% else %}
                    <tr>
                      <td colspan="6">Aucun tournoi trouvé</td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
            <div class="text-center mt-4">
              <a href="{{ path('app_tournoi_new') }}" class="btn btn-primary">Créer un nouveau tournoi</a>
            </div>
            <div class="text-center mt-4">
           </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        $('#search').keyup(function() {
            var query = $(this).val();
            $.ajax({
                url: "{{ path('app_search') }}",
                type: "POST",
                data: {query: query},
                success: function(data) {
                    $('#results').html(data);
                    $('#results').css('width', '100%');
                    $('#results').css('position', 'static');
                }
            });
        });
    });
</script>
<script>
  function sortTournoi() {
    var select = document.getElementById("tri");
    var selectedOption = select.options[select.selectedIndex];
    window.location.href = selectedOption.value;
  }
</script>

{% endblock %}